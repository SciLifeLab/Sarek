FROM nfcore/base:latest

LABEL \
  author="Maxime Garcia" \
  description="VEP image with GRCh37 version 95 genome for use in Sarek" \
  maintainer="maxime.garcia@scilifelab.se"

COPY environment.yml /
RUN conda env create -f /environment.yml && conda clean -a
ENV PATH /opt/conda/envs/sarek-vep-2.2.2/bin:$PATH

# Setup ENV variables
ENV \
  GENOME=GRCh37 \
  VEP_VERSION=95

# Download Genome
RUN vep_install \
  -a cf \
  -c .vep \
  -s homo_sapiens \
  -v ${VEP_VERSION} \
  -y ${GENOME} \
  --CACHE_VERSION ${VEP_VERSION} \
  --NO_HTSLIB --NO_TEST --NO_BIOPERL --NO_UPDATE

# Tabix index genome
RUN vep_convert_cache -species homo_sapiens -version ${VEP_VERSION} --dir .vep
